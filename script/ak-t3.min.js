/*
*
* Author: Akash K Fulari
* Contact-mail: akashfulari31@gmail.com
* Description: Basic Tic-Tac-Toe game using HTML, CSS, & JavaScript
* Created: 2024-08-06 23:10:07
 Last Modification Date: 2024-08-07 08:06:46
*
**/
let cToss = 0;
const USERS = { a: null, b: null };
let cTossHolder = USERS.a;
let cTossName = USERS.a;
let gameOver = false;
let n = 9;
const playBoard = document.getElementById("playBoard");
const p1 = document.getElementById("p1");
const p2 = document.getElementById("p2");
const winnerPlayer = document.getElementById("winnerPlayer");
const indicator = document.getElementById("indicator");

function init() {
    for (let i = 1; i <= n; i++) {
        let b = document.createElement("button");
        b.className = "sqr pl";
        playBoard.appendChild(b);
    }
}

let startGaming = () => {
    askForPlayerName();
    let btns = document.querySelectorAll(".sqr");
    btns.forEach(b => {
        b.onclick = () => {
            if (checkAllOk()) {
                if (gameOver || b.innerHTML != "")
                    return;

                b.classList.remove("pl");
                // Current playe Details
                cTossHolder = ((cToss == 1) ? USERS.b.holder : USERS.a.holder);
                cTossName = ((cToss == 1) ? USERS.b.name : USERS.a.name);

                b.classList.add(((cToss == 0) ? "m" : "p"));
                b.innerHTML = cTossHolder;

                // Imideatly chec winner
                let winner = calculateWinner();
                if (winner != null) {
                    winnerPlayer.classList.add("player" + (cToss + 1));
                    Swal.fire({
                        title: "Win!!!.",
                        html: "Player <b>" + cTossName + "</b> Win.",
                        icon: "success"
                    });
                }
                winnerPlayer.innerHTML = ((winner == null) ? ((document.getElementsByClassName("pl").length == 0) ? "Draw Match" : "--") : cTossName);
                gameOver = (winner != null);

                // Switch after player play role
                indicator.classList.remove("player" + (cToss + 1));
                cToss = ((cToss == 0) ? 1 : 0);
                // Switched Current playe Details
                cTossHolder = ((cToss == 1) ? USERS.b.holder : USERS.a.holder);
                cTossName = ((cToss == 1) ? USERS.b.name : USERS.a.name);
                indicator.classList.add("player" + (cToss + 1));
            }
        };
    });
}

async function askForPlayerName() {
    let { value: U1Name } = await Swal.fire({
        title: "Player Names",
        input: "text",
        inputValue: "Akash",
        inputLabel: "Player1 Name:",
        inputPlaceholder: "Enter Player1 Name"
    });
    let { value: U2Name } = await Swal.fire({
        title: "Player Names",
        input: "text",
        inputValue: "Ambarish",
        inputLabel: "Player2 Name:",
        inputPlaceholder: "Enter Player2 Name"
    });

    U1Name = ((U1Name == undefined || U1Name == "") ? "Akash" : U1Name);
    U2Name = ((U2Name == undefined || U2Name == "") ? "Ambarish" : U2Name);
    let [aname, bname] = processUserNames(U1Name, U2Name);
    USERS.a = { name: U1Name, holder: aname };
    USERS.b = { name: U2Name, holder: bname };
    p1.innerHTML = USERS.a.name;
    p2.innerHTML = USERS.b.name;
}
function checkAllOk() {
    if (USERS.a == null || USERS.b == null)
        return false;
    return true;
}
function replay() {
    navigation.reload();
}
function reset() {
    const squares = document.querySelectorAll(".sqr");
    indicator.classList.remove("player" + (cToss + 1));
    winnerPlayer.classList.remove("player1", "player2");

    squares.forEach(ele => {
        ele.classList.remove("m");
        ele.classList.remove("p");
        ele.innerHTML = "";
    });
    gameOver = false;
    cToss = 0;
    cTossHolder = USERS.a.holder;
    cTossName = USERS.a.name;
    winnerPlayer.innerHTML = "--";
    indicator.classList.add("player" + (cToss + 1));
}
function processUserNames(user1, user2) {
    let result1 = '';
    let result2 = '';
    user1 = user1.toLowerCase();
    user2 = user2.toLowerCase();

    for (let i = 0; i < user1.length && i < user2.length; i++) {
        if (user1[i] !== user2[i]) {
            result1 += user1[i];
            result2 += user2[i];
            break;
        }
        result1 += user1[i];
        result2 += user2[i];
    }

    return [result1.toUpperCase(), result2.toUpperCase()];
}
function calculateWinner() {
    const squares = document.getElementsByClassName("sqr");
    const lines = [
        [0, 1, 2],
        [3, 4, 5],
        [6, 7, 8],
        [0, 3, 6],
        [1, 4, 7],
        [2, 5, 8],
        [0, 4, 8],
        [2, 4, 6],
    ];
    for (let i = 0; i < lines.length; i++) {
        const [a, b, c] = lines[i];
        if (squares[a].innerHTML && squares[a].innerHTML == squares[b].innerHTML && squares[a].innerHTML === squares[c].innerHTML) {
            return squares[a];
        }
    }
    return null;
}

init();
startGaming();